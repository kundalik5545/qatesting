<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Demo - Transactions</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body class="transactions-page">
    <nav class="navbar" id="main-navbar" data-testid="main-navbar">
        <div class="navbar-brand">
            <span class="logo-icon">üè¶</span>
            <span class="brand-name" id="brand-name">SecureBank</span>
        </div>
        <ul class="nav-menu" id="nav-menu">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link" id="nav-dashboard" data-testid="nav-dashboard">
                    üìä Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="accounts.html" class="nav-link" id="nav-accounts" data-testid="nav-accounts">
                    üí≥ Accounts
                </a>
            </li>
            <li class="nav-item">
                <a href="transactions.html" class="nav-link active" id="nav-transactions"
                    data-testid="nav-transactions">
                    üí∏ Transactions
                </a>
            </li>
        </ul>
        <div class="navbar-actions">
            <span class="user-info" id="user-info" data-testid="user-info">
                üë§ <span id="username-display">Admin</span>
            </span>
            <button id="logout-btn" class="btn btn-logout" data-testid="logout-button" data-action="logout">
                Logout
            </button>
        </div>
    </nav>

    <main class="main-content">
        <header class="page-header">
            <h1 class="page-title" id="page-title" data-testid="page-title">Transactions</h1>
            <button id="new-transaction-btn" class="btn btn-primary" data-testid="new-transaction-button"
                data-action="new-transaction">
                ‚ûï New Transaction
            </button>
        </header>

        <section class="filters-section" id="filters-section">
            <div class="filter-group">
                <label for="filter-account" class="filter-label">Account:</label>
                <select id="filter-account" class="filter-select" data-testid="filter-account-select"
                    data-filter="account">
                    <option value="all" selected>All Accounts</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="filter-transaction-type" class="filter-label">Type:</label>
                <select id="filter-transaction-type" class="filter-select" data-testid="filter-transaction-type-select"
                    data-filter="type">
                    <option value="all" selected>All Types</option>
                    <option value="deposit">Deposit</option>
                    <option value="withdrawal">Withdrawal</option>
                    <option value="transfer">Transfer</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="date-from" class="filter-label">From:</label>
                <input type="date" id="date-from" class="filter-input" data-testid="date-from-input"
                    data-filter="date-from" />
            </div>

            <div class="filter-group">
                <label for="date-to" class="filter-label">To:</label>
                <input type="date" id="date-to" class="filter-input" data-testid="date-to-input"
                    data-filter="date-to" />
            </div>

            <button id="apply-filters-btn" class="btn btn-primary" data-testid="apply-filters-button">
                Apply Filters
            </button>

            <button id="reset-filters-btn" class="btn btn-secondary" data-testid="reset-filters-button">
                Reset
            </button>

            <button id="export-btn" class="btn btn-secondary" data-testid="export-button" data-action="export">
                üì• Export
            </button>
        </section>

        <section class="transactions-table-section">
            <div class="table-container">
                <table class="data-table" id="transactions-table" data-testid="transactions-table">
                    <thead>
                        <tr>
                            <th data-column="id">Transaction ID</th>
                            <th data-column="date">Date & Time</th>
                            <th data-column="type">Type</th>
                            <th data-column="account">Account</th>
                            <th data-column="amount">Amount</th>
                            <th data-column="balance">Balance After</th>
                            <th data-column="description">Description</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-tbody" data-testid="transactions-tbody">
                        <tr class="empty-state" id="empty-transactions">
                            <td colspan="7" class="text-center">No transactions found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- New Transaction Modal -->
    <div id="transaction-modal" class="modal" data-testid="transaction-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title" data-testid="modal-title">New Transaction</h2>
                <button id="close-modal" class="close-btn" data-testid="close-modal-button" aria-label="Close modal">
                    ‚úï
                </button>
            </div>

            <form id="transaction-form" class="transaction-form" data-testid="transaction-form">
                <div class="form-group">
                    <label for="transaction-type" class="form-label">Transaction Type *</label>
                    <select id="transaction-type" name="transactionType" class="form-select"
                        data-testid="transaction-type-select" required>
                        <option value="">Select type</option>
                        <option value="deposit">Deposit</option>
                        <option value="withdrawal">Withdrawal</option>
                        <option value="transfer">Transfer</option>
                    </select>
                    <span class="error-message" id="transaction-type-error"></span>
                </div>

                <div class="form-group">
                    <label for="from-account" class="form-label">From Account *</label>
                    <select id="from-account" name="fromAccount" class="form-select" data-testid="from-account-select"
                        required>
                        <option value="">Select account</option>
                    </select>
                    <span class="error-message" id="from-account-error"></span>
                </div>

                <div class="form-group" id="to-account-group" style="display: none;">
                    <label for="to-account" class="form-label">To Account *</label>
                    <select id="to-account" name="toAccount" class="form-select" data-testid="to-account-select">
                        <option value="">Select account</option>
                    </select>
                    <span class="error-message" id="to-account-error"></span>
                </div>

                <div class="form-group">
                    <label for="transaction-amount" class="form-label">Amount *</label>
                    <input type="number" id="transaction-amount" name="transactionAmount" class="form-input"
                        placeholder="0.00" step="0.01" min="0.01" data-testid="transaction-amount-input" required />
                    <span class="error-message" id="transaction-amount-error"></span>
                    <span class="helper-text" id="available-balance">Available balance: $0.00</span>
                </div>

                <div class="form-group">
                    <label for="transaction-description" class="form-label">Description</label>
                    <textarea id="transaction-description" name="transactionDescription" class="form-textarea"
                        placeholder="Optional description" rows="3" data-testid="transaction-description-input"
                        maxlength="200"></textarea>
                    <span class="char-count" id="char-count">0/200</span>
                </div>

                <div class="form-group checkbox-group">
                    <input type="checkbox" id="send-notification" name="sendNotification" class="form-checkbox"
                        data-testid="notification-checkbox" checked />
                    <label for="send-notification" class="checkbox-label">Send email notification</label>
                </div>

                <div class="alert-box" id="transaction-alert" data-testid="transaction-alert" style="display: none;">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <span class="alert-message" id="transaction-alert-message"></span>
                </div>

                <div class="modal-actions">
                    <button type="submit" id="submit-transaction-btn" class="btn btn-primary"
                        data-testid="submit-transaction-button">
                        Submit Transaction
                    </button>
                    <button type="button" id="cancel-transaction-btn" class="btn btn-secondary"
                        data-testid="cancel-transaction-button">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="storage.js"></script>
    <script src="transactions.js"></script>
    <script>
        // Check authentication
        const currentUser = sessionStorage.getItem('currentUser');
        if (!currentUser) {
            window.location.href = 'index.html';
        }

        document.getElementById('username-display').textContent = currentUser;

        // Logout
        document.getElementById('logout-btn').addEventListener('click', function () {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        });

        // Theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);

        // Character count for description
        document.getElementById('transaction-description').addEventListener('input', function () {
            const count = this.value.length;
            document.getElementById('char-count').textContent = `${count}/200`;
        });
    </script>
</body>

</html>